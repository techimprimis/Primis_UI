<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/login" text="" color="medium"></ion-back-button>
    </ion-buttons>
    <ion-title>Forgot Password</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="forgot-password-container">
        @if (!emailSent()) {
          <!-- Request Reset Form -->
          <div class="card-header">
            <div class="icon-container">
              <ion-icon name="mail-outline" class="header-icon"></ion-icon>
            </div>
            <h1 class="card-title">Forgot Password?</h1>
            <p class="card-subtitle">No worries! Enter your email address and we'll send you a link to reset your password.</p>
          </div>

          <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()" style="width: 100%;">
            <ion-input
              formControlName="email"
              type="email"
              label="Email Address"
              labelPlacement="stacked"
              placeholder="Enter your email"
              autocomplete="email"
              fill="outline"
              class="input-field"
            ></ion-input>
            @if (emailControl?.touched && emailControl?.errors) {
              <ion-text color="danger" class="error-message">
                @if (emailControl?.errors?.['required']) {
                  <small>Email is required</small>
                } @else if (emailControl?.errors?.['email']) {
                  <small>Please enter a valid email</small>
                }
              </ion-text>
            }

            <ion-button
              type="submit"
              expand="block"
              class="submit-btn"
              [disabled]="isLoading()"
            >
              @if (isLoading()) {
                <ion-spinner name="crescent"></ion-spinner>
              } @else {
                Send Reset Link
              }
            </ion-button>
          </form>
        } @else {
          <!-- Success State -->
          <div class="success-state">
            <div class="success-icon-container">
              <ion-icon name="checkmark-circle-outline" class="success-icon"></ion-icon>
            </div>
            <h1 class="card-title">Check Your Email</h1>
            <p class="card-subtitle">
              We've sent a password reset link to<br>
              <strong>{{ submittedEmail() }}</strong>
            </p>
            <p class="instruction-text">
              Click the link in the email to reset your password. If you don't see the email, check your spam folder.
            </p>

            <ion-button
              expand="block"
              fill="outline"
              class="resend-btn"
              (click)="resetForm()"
            >
              Didn't receive email? Try again
            </ion-button>

            <ion-button
              expand="block"
              routerLink="/login"
              class="back-to-login-btn"
            >
              Back to Sign In
            </ion-button>
          </div>
        }
      <!-- End main content -->
  </div>
</ion-content>
